<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</title>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f3f4f6; }
    input, select { padding: 10px; margin: 5px 0; width: 100%; }
    button { padding: 10px 15px; margin-top: 10px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ddd; padding: 8px; }
    th { background: #4f46e5; color: white; }
  </style>
</head>
<body>
  <h1>‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏à‡∏≠‡∏á‡πÇ‡∏ï‡πä‡∏∞</h1>

  <!-- QR PromptPay -->
  <p>üìå ‡∏™‡πÅ‡∏Å‡∏ô‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà:</p>
  <img src="https://promptpay.io/0512856125.png" alt="PromptPay QR" style="width: 200px; margin: 10px 0;">

  <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô -->
  <form id="booking-form">
    <input type="text" id="fullName" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" required />
    <input type="tel" id="phone" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå" required />
    <input type="text" id="department" placeholder="‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô" required />
    <select id="tableCount" required>
      <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÇ‡∏ï‡πä‡∏∞</option>
      <option>1 ‡πÇ‡∏ï‡πä‡∏∞</option><option>2 ‡πÇ‡∏ï‡πä‡∏∞</option>
      <option>3 ‡πÇ‡∏ï‡πä‡∏∞</option><option>4 ‡πÇ‡∏ï‡πä‡∏∞</option>
    </select>
    <select id="paymentStatus" required>
      <option value="">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</option>
      <option value="‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏•‡∏¢">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏•‡∏¢</option>
      <option value="‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ä‡∏≥‡∏£‡∏∞">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ä‡∏≥‡∏£‡∏∞</option>
    </select>
    <input type="email" id="email" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏• (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)" />
    <input type="file" id="paymentSlip" accept="image/*" />
    <button type="submit">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</button>
  </form>

  <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• -->
  <h2>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</h2>
  <table>
    <thead>
      <tr>
        <th>‡∏ä‡∏∑‡πà‡∏≠</th><th>‡πÄ‡∏ö‡∏≠‡∏£‡πå</th><th>‡πÇ‡∏ï‡πä‡∏∞</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th><th>‡∏™‡∏•‡∏¥‡∏õ</th><th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
      </tr>
    </thead>
    <tbody id="data-tbody"><tr><td colspan="6">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td></tr></tbody>
  </table>

  <!-- Modal ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç -->
  <div id="edit-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:#00000088;">
    <div style="background:white; padding:20px; max-width:500px; margin:50px auto; border-radius:8px;">
      <h3>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
      <form id="edit-form">
        <input id="edit-fullName" placeholder="‡∏ä‡∏∑‡πà‡∏≠" required />
        <input id="edit-phone" readonly />
        <input id="edit-department" placeholder="‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô" />
        <select id="edit-tableCount">
          <option value="">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÇ‡∏ï‡πä‡∏∞</option><option>1 ‡πÇ‡∏ï‡πä‡∏∞</option><option>2 ‡πÇ‡∏ï‡πä‡∏∞</option>
        </select>
        <select id="edit-paymentStatus">
          <option value="">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</option>
          <option value="‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏•‡∏¢">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏•‡∏¢</option>
          <option value="‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ä‡∏≥‡∏£‡∏∞">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ä‡∏≥‡∏£‡∏∞</option>
        </select>
        <input id="edit-email" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•" />
        <input type="file" id="edit-slip" accept="image/*" />
        <button type="submit">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        <button type="button" onclick="closeEditModal()">‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
      </form>
    </div>
  </div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbynZIlDwscUHJ22yZp7OXfRd7DfXmCfhucy1-z_bl6hFZhOwPxOa2aipnyoo43P4w2vcg/exec";

function loadRegistrationData() {
  fetch(SCRIPT_URL + "?action=getData")
    .then(res => res.json())
    .then(json => {
      const tbody = document.getElementById("data-tbody");
      tbody.innerHTML = "";
      json.data.forEach(item => {
        tbody.innerHTML += `
          <tr>
            <td>${item.fullName}</td>
            <td>${item.phone}</td>
            <td>${item.tableCount}</td>
            <td>${item.paymentStatus}</td>
            <td>${item.slipUrl ? `<a href="${item.slipUrl}" target="_blank">‡∏î‡∏π</a>` : '-'}</td>
            <td>
              <button onclick='openEditModal(${JSON.stringify(item)})'>‚úèÔ∏è</button>
              <button onclick='deleteEntry("${item.phone}")'>üóëÔ∏è</button>
            </td>
          </tr>`;
      });
    });
}

document.getElementById("booking-form").addEventListener("submit", async e => {
  e.preventDefault();
  const file = document.getElementById("paymentSlip").files[0];
  const base64 = file ? await toBase64(file) : null;

  const data = {
    fullName: fullName.value,
    phone: phone.value,
    department: department.value,
    tableCount: tableCount.value,
    paymentStatus: paymentStatus.value,
    email: email.value,
    paymentSlip: file ? { data: base64, filename: file.name, type: file.type } : null
  };

  fetch(SCRIPT_URL, {
    method: "POST",
    body: JSON.stringify(data),
    headers: { "Content-Type": "application/json" }
  }).then(() => {
    Swal.fire("‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", "‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢", "success");
    e.target.reset(); loadRegistrationData();
  });
});

async function deleteEntry(phone) {
  await fetch(SCRIPT_URL, {
    method: "POST",
    body: JSON.stringify({ action: "delete", phone }),
    headers: { "Content-Type": "application/json" }
  });
  loadRegistrationData();
}

function openEditModal(item) {
  edit_fullName.value = item.fullName;
  edit_phone.value = item.phone;
  edit_department.value = item.department;
  edit_tableCount.value = item.tableCount;
  edit_paymentStatus.value = item.paymentStatus;
  edit_email.value = item.email;
  document.getElementById("edit-modal").style.display = "block";
}

function closeEditModal() {
  document.getElementById("edit-modal").style.display = "none";
}

document.getElementById("edit-form").addEventListener("submit", async e => {
  e.preventDefault();
  const file = document.getElementById("edit-slip").files[0];
  const base64 = file ? await toBase64(file) : null;

  const data = {
    action: "edit",
    phone: edit_phone.value,
    fullName: edit_fullName.value,
    department: edit_department.value,
    tableCount: edit_tableCount.value,
    paymentStatus: edit_paymentStatus.value,
    email: edit_email.value,
    paymentSlip: file ? { data: base64, filename: file.name, type: file.type } : null
  };

  await fetch(SCRIPT_URL, {
    method: "POST",
    body: JSON.stringify(data),
    headers: { "Content-Type": "application/json" }
  });
  closeEditModal();
  loadRegistrationData();
});

function toBase64(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.readAsDataURL(file);
    reader.onload = () => resolve(reader.result);
    reader.onerror = error => reject(error);
  });
}

document.addEventListener("DOMContentLoaded", loadRegistrationData);
</script>
</body>
</html>
